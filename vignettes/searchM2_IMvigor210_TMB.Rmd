---
title: "intro_dualmarker"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{intro_dualmarker}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r, include=F}
library(dualmarker)
library(stringr)
library(dplyr)
```

# dm_pair
## Example of dm_pair, response ~ TMB + ?
```{r example, fig.width=6, fig.height=5, include=F, warning=F, message=F}
## basic example code
res.pair <- dm_pair(
   data = clin_bmk_IMvigor210, 
   # response
   response = "binaryResponse", response.pos = "CR/PR", response.neg = "SD/PD", 
   # survival
   time = "os", event = "censOS",
   marker1 = "TMB",
   #marker2 = "gepscore_CD.8.T.effector",
   #marker2 = "gep_MS4A2"
   #marker2 = "gep_RAG1"
   # marker2 = "gep_CXCL9"
   # marker2 = "gep_CXCL13"
   # marker2 = "gep_ESPL1"
   # marker2 = "mut_FGFR1", m2.cat.pos = "YES", m2.cat.neg = "NO"
   marker2 = "mut_TP53", m2.cat.pos = "YES", m2.cat.neg = "NO"
   )
res.pair$response.plot
res.pair$survival.plot
```

# GEPscore
## Example: response ~ gepscore
```{r}
candidates <- str_subset(colnames(clin_bmk_IMvigor210),"gepscore_")
length(candidates)
res.sm.logit.gepscore <- sm_searchM_logit(
   data = clin_bmk_IMvigor210, 
    # response info
   response = "binaryResponse", 
   response.pos = "CR/PR", 
   response.neg = "SD/PD", 
    # marker
   candidates = candidates
   # coufounding factor
   # confound.factor = c("Baseline.ECOG.Score","Met.Disease.Status")
   #confound.factor = "Immune.phenotype"
   )
sm_searchM_topPlot(res.sm.logit.gepscore, top.n = 10)
```

## Example: response ~ TMB + gepscore
```{r}
m2.candidates <- str_subset(colnames(clin_bmk_IMvigor210),"gepscore_")
length(m2.candidates)
res.dm.logit.gepscore <- dm_searchM2_logit(
   data = clin_bmk_IMvigor210, 
    # response info
   response = "binaryResponse", 
   response.pos = "CR/PR", 
   response.neg = "SD/PD", 
    # marker1
   marker1 = "TMB",
   m1.binarize = F, # use continuous variables
    # marker2
   m2.candidates = m2.candidates, 
   m2.binarize = F, 
   # coufounding factor
   # confound.factor = c("Baseline.ECOG.Score","Met.Disease.Status")
   #confound.factor = "Immune.phenotype"
   )
dm_searchM2_topPlot(res.dm.logit.gepscore)
```
## Example: OS ~ gepscore
```{r}
candidates <- str_subset(colnames(clin_bmk_IMvigor210),"gepscore_")
length(candidates)
res.sm.cox.gepscore <- sm_searchM_cox(
   data = clin_bmk_IMvigor210, 
   # survival
   time = "os", event = "censOS", 
    # marker
   candidates = candidates
   # coufounding factor
   # confound.factor = c("Baseline.ECOG.Score","Met.Disease.Status")
   #confound.factor = "Immune.phenotype"
   )
sm_searchM_topPlot(res.sm.cox.gepscore, top.n = 10)
```


## Example: OS ~ TMB + gepscore
```{r}
m2.candidates <- str_subset(colnames(clin_bmk_IMvigor210),"gepscore_")
length(m2.candidates)
res.dm.cox.gepscore <- dm_searchM2_cox(
   data = clin_bmk_IMvigor210, 
   # survival
   time = "os", event = "censOS",
   # marker1
   marker1 = "TMB",
   m1.binarize = F, # use continuous variables
    # marker2
   m2.candidates = m2.candidates, 
   m2.binarize = F, 
   # coufounding factor
   # confound.factor = c("Baseline.ECOG.Score","Met.Disease.Status")
   #confound.factor = "Immune.phenotype"
   )
dm_searchM2_topPlot(res.dm.cox.gepscore)
```

# GEP
## Example: Response ~ gep
```{r}
candidates <- str_subset(colnames(clin_bmk_IMvigor210),"gep_")
length(candidates)
res.sm.logit.gep <- sm_searchM_logit(
   data = clin_bmk_IMvigor210, 
    # response info
   response = "binaryResponse", 
   response.pos = "CR/PR", 
   response.neg = "SD/PD", 
    # marker
   candidates = candidates
   # coufounding factor
   # confound.factor = c("Baseline.ECOG.Score","Met.Disease.Status")
   #confound.factor = "Immune.phenotype"
   )
sm_searchM_topPlot(res.sm.logit.gep, top.n = 10)
```



## Example: Response ~ TMB + gep
Here we demonstrated searchM2 function to combine with TMB for signatures
```{r}
m2.candidates <- str_subset(colnames(clin_bmk_IMvigor210),"gep_")
length(m2.candidates)
res.dm.logit.gep <- dm_searchM2_logit(
   data = clin_bmk_IMvigor210, 
    # response info
   response = "binaryResponse", 
   response.pos = "CR/PR", 
   response.neg = "SD/PD", 
    # marker1
   marker1 = "TMB",
   m1.binarize = F, # use continuous variables
    # marker2
   m2.candidates = m2.candidates, 
   m2.binarize = F, 
   #m2.cat.pos = "YES", m2.cat.neg = "NO",
   # coufounding factor
   # confound.factor = c("Baseline.ECOG.Score","Met.Disease.Status")
   #confound.factor = "Immune.phenotype"
)
dm_searchM2_topPlot(res.dm.logit.gep)
```

## Example: survival ~ gep
```{r}
candidates <- str_subset(colnames(clin_bmk_IMvigor210),"gep_")
length(candidates)
res.sm.cox.gep <- sm_searchM_cox(
   data = clin_bmk_IMvigor210, 
   # survival
   time = "os", event = "censOS", 
    # marker
   candidates = candidates
   # coufounding factor
   # confound.factor = c("Baseline.ECOG.Score","Met.Disease.Status")
   #confound.factor = "Immune.phenotype"
   )
sm_searchM_topPlot(res.sm.cox.gep, top.n = 10)
```
## Example: survival ~ TMB + gep
Here we demonstrated searchM2 function to combine with TMB for signatures
```{r}
m2.candidates <- str_subset(colnames(clin_bmk_IMvigor210),"gep_")
length(m2.candidates)
res.dm.cox.gep <- dm_searchM2_cox(
   data = clin_bmk_IMvigor210, 
   # survival
   time = "os", event = "censOS",
    # marker1
   marker1 = "TMB",
   m1.binarize = F, # use continuous variables
    # marker2
   m2.candidates = m2.candidates, 
   m2.binarize = F, 
   #m2.cat.pos = "YES", m2.cat.neg = "NO",
   # coufounding factor
   # confound.factor = c("Baseline.ECOG.Score","Met.Disease.Status")
   #confound.factor = "Immune.phenotype"
)
dm_searchM2_topPlot(res.dm.cox.gep)
```

# Mutation
## Example: response ~ mutation
```{r}
candidates <- str_subset(colnames(clin_bmk_IMvigor210),"mut_")
length(candidates)
res.sm.logit.mut <- sm_searchM_logit(
   data = clin_bmk_IMvigor210, 
    # response info
   response = "binaryResponse", 
   response.pos = "CR/PR", 
   response.neg = "SD/PD", 
    # marker
   candidates = candidates, 
   binarize = T, cat.pos = "YES", cat.neg = "NO"
   # coufounding factor
   # confound.factor = c("Baseline.ECOG.Score","Met.Disease.Status")
   #confound.factor = "Immune.phenotype"
   )
sm_searchM_topPlot(res.sm.logit.mut, top.n = 10)
```

## Example: response ~ TMB + mutation
```{r}
m2.candidates <- str_subset(colnames(clin_bmk_IMvigor210),"mut_")
length(m2.candidates)
res.dm.logit.mut <- dm_searchM2_logit(
   data = clin_bmk_IMvigor210, 
    # response info
   response = "binaryResponse", 
   response.pos = "CR/PR", 
   response.neg = "SD/PD", 
    # marker1
   marker1 = "TMB",
   m1.binarize = F, # use continuous variables
    # marker2
   m2.candidates = m2.candidates, 
   m2.binarize = T, 
   m2.cat.pos = "YES", 
   m2.cat.neg = "NO")
dm_searchM2_topPlot(res.dm.logit.mut)
```
## Example: survival ~ gep
```{r}
candidates <- str_subset(colnames(clin_bmk_IMvigor210),"mut_")
length(candidates)
res.sm.cox.mut <- sm_searchM_cox(
   data = clin_bmk_IMvigor210, 
   # survival
   time = "os", event = "censOS", 
    # marker
   candidates = candidates, binarize = T, cat.pos = "YES", cat.neg = "NO"
   # coufounding factor
   # confound.factor = c("Baseline.ECOG.Score","Met.Disease.Status")
   #confound.factor = "Immune.phenotype"
   )
sm_searchM_topPlot(res.sm.cox.mut, top.n = 15)
```


## Example: survival ~ TMB + mutation
```{r}
m2.candidates <- str_subset(colnames(clin_bmk_IMvigor210),"mut_")
length(m2.candidates)
res.dm.logit <- dm_searchM2_logit(
   data = clin_bmk_IMvigor210, 
    # response info
   response = "binaryResponse", 
   response.pos = "CR/PR", 
   response.neg = "SD/PD", 
    # marker1
   marker1 = "TMB",
   m1.binarize = F, # use continuous variables
    # marker2
   m2.candidates = m2.candidates, 
   m2.binarize = T, 
   m2.cat.pos = "YES", 
   m2.cat.neg = "NO")
dm_searchM2_topPlot(res.dm.logit)
```
